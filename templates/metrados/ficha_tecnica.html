{% extends "bases/base.html" %}

{% block styles %}
	<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}fecha/css/bootstrap-datetimepicker.min.css" />
	<style>
		.delete-row {float: right;}
		.bold {font-weight: bold;}
		.help-block{color: #f00;}
	</style>
{% endblock %}

{% block content %}
	<div class="row">
		<div class="col-lg-12">
			<div class="panel panel-default">
				<div class="panel-heading"><strong>PLANILLA DE METRADO Y PRESUPUESTO</strong></div>
				<div class="panel-body">
					<div class="col-lg-6">
						<div class="col-md-9">
							<span class="control-label bold">DEPARTAMENTO: </span>
							<span>{{ departamento }}</span>
						</div>
						<div class="col-md-9">
							<span class="control-label bold">PROVINCIA: </span>
							<span>{{ provincia }}</span>
						</div>
						<div class="col-md-9">
							<span class="control-label bold">DISTRITO: </span>
							<span>{{ distrito }}</span>
						</div>
					</div>
					<div class="col-lg-6">
						<div class="col-md-9">
							<span class="control-label bold">UNIDAD: </span>
							<span>{{ obj.unidad_ejecutora }}</span>
						</div>
						<div class="col-md-9">
							<span class="control-label bold">FECHA: </span>
							<span>{{ obj.created_at|date:"d/m/y" }}</span>
						</div>
						<div class="col-md-9">
							<span class="control-label bold">HEHO POR: </span>
							<span>{{ obj.nombre }}</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<form class="form-horizontal" role="form" method="post" enctype="multipart/form-data" action id="ficha-tecnica-form">
		<div class="row">
			<div class="col-lg-12">
				<div class="panel panel-default">
					<div class="panel-heading"><strong>FICHA TECNICA DE EVALUACION DE LA INFRAESTRUCTURA DE LOCALES POLICIALES PARA ENFRENTAR EL FENOMENO DEL "NIÃ‘O 2015-2016"</strong></div>
					<div class="panel-body">
						<table id="fmr_ft" class="table-responsive table">
							<tbody>
								{% for form in fiche_tecnica_form %}
									<tr>
										<td>
											<div class="row">
												{% csrf_token %}
												<div class="col-md-12">
													<label class="control-label" for="id_nombre">
														<span class="pull-left">Nombre de la partida:</span>
														<div class="col-md-3 pull-right">
															{% for posicion in posicion_ayuda %}
																{% if posicion == 1 %}
																	<a href="{% url 'show_ayuda' form_ayuda posicion %}" data-toggle="modal" data-target="#{{ posicion }}">
																		<img height="20px" width="20px" src="{{ STATIC_URL }}img/icon_question.png" alt="icon_question.png">
																	</a>
																{% endif %}
															{% endfor %}
														</div>
													</label>
												</div>
												<div class="col-lg-3">
													<input id="id_ficha_tecnica-0-nombre" list="id_ficha_tecnica-0-name" class="form-control" />
													<datalist id="id_ficha_tecnica-0-name">
														{% for metrado in metrados %}
															<option value="{{ metrado.descripcion }}"></option>
														{% endfor %}
													</datalist>
												</div>
												<div class="col-lg-3">
													<input type="button" class="btn btn-default" id="id_ficha_tecnica-0-buscar" value="Buscar"/>
												</div>
											</div>
											<br/>
											<div class="row">
												<div class="col-md-12">
													<label class="control-label" for="id_metrado">
														<span class="pull-left">Partida:</span>
														<div class="col-md-3 pull-right">
															{% for posicion in posicion_ayuda %}
																{% if posicion == 2 %}
																	<a href="{% url 'show_ayuda' form_ayuda posicion %}" data-toggle="modal" data-target="#{{ posicion }}">
																		<img height="20px" width="20px" src="{{ STATIC_URL }}img/icon_question.png" alt="icon_question.png">
																	</a>
																{% endif %}
															{% endfor %}
														</div>
													</label>
												</div>
												<div class="col-lg-3">
													{{ form.metrado1 }}
												</div>
												<div class="col-lg-3">
													<select class="form-control" id="id_ficha_tecnica-0-metrado2" name="ficha_tecnica-0-metrado2">
														<option></option>
													</select>
												</div>
												<div class="col-lg-3">
													<select class="form-control" id="id_ficha_tecnica-0-metrado3" name="ficha_tecnica-0-metrado3">
														<option></option>
													</select>
												</div>
												<div class="col-lg-3">
													<select class="form-control" id="id_ficha_tecnica-0-metrado4" name="ficha_tecnica-0-metrado4">
														<option></option>
													</select>
												</div>
											</div>
											<br/>
											<div class="row">
												<div class="col-lg-3">
													<label class="control-label" for="id_numero">
														<span class="pull-left">N:</span>
														<div class="col-md-3 pull-right">
															{% for posicion in posicion_ayuda %}
																{% if posicion == 3 %}
																	<a href="{% url 'show_ayuda' form_ayuda posicion %}" data-toggle="modal" data-target="#{{ posicion }}">
																		<img height="20px" width="20px" src="{{ STATIC_URL }}img/icon_question.png" alt="icon_question.png">
																	</a>
																{% endif %}
															{% endfor %}
														</div>
													</label>
													{{ form.numero }}
													{% if form.numero.errors %}<p class="help-block">{{ form.errors.numero|striptags }}</p>{% endif %}
												</div>
												<div class="col-lg-3">
													<label class="control-label" for="id_largo">
														<span class="pull-left">Largo:</span>
														<div class="col-md-3 pull-right">
															{% for posicion in posicion_ayuda %}
																{% if posicion == 4 %}
																	<a href="{% url 'show_ayuda' form_ayuda posicion %}" data-toggle="modal" data-target="#{{ posicion }}">
																		<img height="20px" width="20px" src="{{ STATIC_URL }}img/icon_question.png" alt="icon_question.png">
																	</a>
																{% endif %}
															{% endfor %}
														</div>
													</label>
													{{ form.largo }}
													{% if form.largo.errors %}<p class="help-block">{{ form.errors.largo|striptags }}</p>{% endif %}
												</div>
												<div class="col-lg-3">
													<label class="control-label" for="id_ancho">
														<span class="pull-left">Ancho:</span>
														<div class="col-md-3 pull-right">
															{% for posicion in posicion_ayuda %}
																{% if posicion == 5 %}
																	<a href="{% url 'show_ayuda' form_ayuda posicion %}" data-toggle="modal" data-target="#{{ posicion }}">
																		<img height="20px" width="20px" src="{{ STATIC_URL }}img/icon_question.png" alt="icon_question.png">
																	</a>
																{% endif %}
															{% endfor %}
														</div>
													</label>
													{{ form.ancho }}
													{% if form.ancho.errors %}<p class="help-block">{{ form.errors.ancho|striptags }}</p>{% endif %}
												</div>
												<div class="col-lg-3">
													<label class="control-label" for="id_alto">
														<span class="pull-left">Alto:</span>
														<div class="col-md-3 pull-right">
															{% for posicion in posicion_ayuda %}
																{% if posicion == 6 %}
																	<a href="{% url 'show_ayuda' form_ayuda posicion %}" data-toggle="modal" data-target="#{{ posicion }}">
																		<img height="20px" width="20px" src="{{ STATIC_URL }}img/icon_question.png" alt="icon_question.png">
																	</a>
																{% endif %}
															{% endfor %}
														</div>
													</label>
													{{ form.alto }}
													{% if form.alto.errors %}<p class="help-block">{{ form.errors.alto|striptags }}</p>{% endif %}
												</div>      
											</div>
											<br/>
											<div class="row">
												<div class="col-lg-3">
													<label class="control-label" for="id_parcial">
														<span class="pull-left">Parcial:</span>
														<div class="col-md-3 pull-right">
															{% for posicion in posicion_ayuda %}
																{% if posicion == 7 %}
																	<a href="{% url 'show_ayuda' form_ayuda posicion %}" data-toggle="modal" data-target="#{{ posicion }}">
																		<img height="20px" width="20px" src="{{ STATIC_URL }}img/icon_question.png" alt="icon_question.png">
																	</a>
																{% endif %}
															{% endfor %}
														</div>
													</label>
													{{ form.parcial }}
													{% if form.parcial.errors %}<p class="help-block">{{ form.errors.parcial|striptags }}</p>{% endif %}
												</div>
												<div class="col-lg-3">
													<label class="control-label" for="id_unidad">
														<span class="pull-left">Unidad:</span>
														<div class="col-md-3 pull-right">
															{% for posicion in posicion_ayuda %}
																{% if posicion == 8 %}
																	<a href="{% url 'show_ayuda' form_ayuda posicion %}" data-toggle="modal" data-target="#{{ posicion }}">
																		<img height="20px" width="20px" src="{{ STATIC_URL }}img/icon_question.png" alt="icon_question.png">
																	</a>
																{% endif %}
															{% endfor %}
														</div>
													</label>
													{{ form.unidad }}
													{% if form.unidad.errors %}<p class="help-block">{{ form.errors.unidad|striptags }}</p>{% endif %}
												</div>
												<div class="col-lg-3">
													<label class="control-label" for="id_punitario">
														<span class="pull-left">P. Unitario:</span>
														<div class="col-md-3 pull-right">
															{% for posicion in posicion_ayuda %}
																{% if posicion == 9 %}
																	<a href="{% url 'show_ayuda' form_ayuda posicion %}" data-toggle="modal" data-target="#{{ posicion }}">
																		<img height="20px" width="20px" src="{{ STATIC_URL }}img/icon_question.png" alt="icon_question.png">
																	</a>
																{% endif %}
															{% endfor %}
														</div>
													</label>
													{{ form.punitario }}
													{% if form.punitario.errors %}<p class="help-block">{{ form.errors.punitario|striptags }}</p>{% endif %}
												</div>
											</div>
											<br/><br/>
											<div class="panel-body">
												<div class="table-responsive">
													<table id="id_ficha_tecnica-0-tabla" class="table table-bordered">
														<thead>
															<tr>
																<th rowspan="2" scope="col">Partida</th>
																<th rowspan="1" scope="col">N</th>
																<th colspan="3" scope="col">DIMENSIONES</th>
																<th rowspan="2" scope="col">Parcial</th>
																<th rowspan="2" scope="col">Total</th>
																<th rowspan="2" scope="col">Unidad</th>
																<th rowspan="2" scope="col">Precio Unitario</th>
																<th rowspan="2" scope="col">Precio Total</th>
															</tr>
															<tr>
																<th scope="col">Veces</th>
																<th scope="col">Largo</th>
																<th scope="col">Ancho</th>
																<th scope="col">Altura</th>
															</tr>
														</thead>
														<tbody>
															<tr>
																<td id="td-partida"></td>
																<td id="td-numero-veces"></td>
																<td id="td-dimensiones-largo"></td>
																<td id="td-dimensiones-ancho"></td>
																<td id="td-dimensiones-altura"></td>
																<td id="td-parcial"></td>
																<td id="td-total"></td>
																<td id="td-unidad"></td>
																<td id="td-precio-unitario"></td>
																<td id="td-precio-total"></td>
															</tr>
														</tbody>
													</table>
												</div>
											</div>
											{% for hidden in form.hidden_fields %}
												{{ hidden }}
											{% endfor %}
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
						{{ fiche_tecnica_form.management_form }}
						<input type="submit" id="submit" class="btn btn-success" value="Listo!"/>
					</div>
				</div>
			</div>
		</div>
	</form>
	{% for posicion in posicion_ayuda %}
		<div class="modal fade" id="{{ posicion }}" tabindex="-1" role="dialog" aria-labelledby="{{ posicion }}" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content"></div> 
			</div> 
		</div>
	{% endfor %}
{% endblock %}

{% block scripts %}
	<script src="{{ STATIC_URL }}js/metrados.js"></script>
	<script src="{{ STATIC_URL }}js/jquery.formset.js"></script>
	<script type="text/javascript">
		$(function () {
			$('#fmr_ft > tbody > tr').formset({
				prefix: '{{ fiche_tecnica_form.prefix }}',
				deleteText: "<i class='fa fa-trash-o'></i>",
				addText: "<i class='fa fa-plus-square-o'></i>",
				formCssClass: 'dynamic-formset1'
			});
		});
	</script>
{% endblock %}